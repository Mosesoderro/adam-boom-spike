<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ADAM BOOM SPIKE</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.css">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #0f0;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header, footer {
      padding: 1em;
      background: #222;
    }
    main {
      padding: 1em;
    }
    #chart-container {
      max-width: 100%;
      margin: auto;
    }
    #signal {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    #spike-time {
      margin-top: 10px;
      font-size: 1em;
      color: #ff0;
    }
    audio {
      display: none;
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>ðŸš¨ ADAM BOOM SPIKE ðŸš¨</h1>
      <p>Market: Boom 1000 | Timeframe: 1 Hour</p>
    </header>

    <main>
      <div id="chart-container">
        <div id="chart" style="height: 500px;"></div>
      </div>
      <div id="signal">Monitoring for spikes...</div>
      <div id="spike-time"></div>
      <audio id="siren" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
    </main>

    <footer>
      <p>Â© 2025 Sheriff Adam ðŸ’°</p>
    </footer>
  </div>

  <script>
    const chartEl = document.querySelector('#chart');
    const signalEl = document.getElementById('signal');
    const timeEl = document.getElementById('spike-time');
    const siren = document.getElementById('siren');
    let chart;
    let ws;

    function connect() {
      const symbol = 'boom_1000_index';
      const granularity = 3600; // 1 hour
      const appId = 1089;

      ws = new WebSocket(`wss://ws.derivws.com/websockets/v3?app_id=${appId}`);

      ws.onopen = () => {
        ws.send(JSON.stringify({
          ticks_history: symbol,
          style: 'candles',
          adjust_start_time: 1,
          count: 50,
          granularity,
          subscribe: 1
        }));
      };

      ws.onmessage = (msg) => {
        const data = JSON.parse(msg.data);
        const candles = data.candles || data.history?.candles || [];

        if (candles.length) {
          const seriesData = candles.map(c => ({
            x: new Date(c.epoch * 1000),
            y: [parseFloat(c.open), parseFloat(c.high), parseFloat(c.low), parseFloat(c.close)]
          }));
          updateChart(seriesData);
          detectSpike(seriesData);
        }
      };

      ws.onerror = (e) => console.error('WebSocket error:', e);
      ws.onclose = () => console.warn('WebSocket closed. Retrying in 3s...') || setTimeout(connect, 3000);
    }

    function updateChart(data) {
      if (!chart) {
        chart = new ApexCharts(chartEl, {
          chart: {
            type: 'candlestick',
            height: 500,
            background: '#111',
            foreColor: '#0f0'
          },
          series: [{ data }],
          xaxis: { type: 'datetime' },
          plotOptions: {
            candlestick: {
              colors: {
                upward: '#00f',
                downward: '#f00'
              }
            }
          }
        });
        chart.render();
      } else {
        chart.updateSeries([{ data }]);
      }
    }

    function detectSpike(data) {
      if (data.length < 2) return;
      const last = data[data.length - 1];
      const prev = data[data.length - 2];

      const spike = last.y[1] - last.y[0];
      const prevRange = prev.y[1] - prev.y[0];

      if (spike > prevRange * 1.5) {
        signalEl.textContent = 'ðŸš¨ Spike detected!';
        timeEl.textContent = `Spike Time: ${last.x.toLocaleString()}`;
        siren.play();
      } else {
        signalEl.textContent = 'Monitoring for spikes...';
        timeEl.textContent = '';
      }
    }

    connect();
  </script>
</body>
</html>
